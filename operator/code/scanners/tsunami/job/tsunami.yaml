apiVersion: batch/v1
kind: Job
metadata:
  name: tsunami
spec:
  template:
    spec:
      containers:
      - name: tsunami
        image: sammascanner/tsunami:v0.1
        args: ["--ip-v4-target=158.174.104.17","--scan-results-local-output-format=JSON","--scan-results-local-output-filename=/out/tsunami-output.json"]
        #command: ["--ip-v4-target=158.174.104.17","--scan-results-local-output-format=JSON","--scan-results-local-output-filename=/out/tsunami-output.json"]
        env:
          - name: TARGET
            value: samma.io
          - name: SAMMA_IO_SCANNER
            value: tsunami
          - name: SAMMA_IO_ID
            value: "00000"
          - name: SAMMA_IO_TAGS
            value: "['scanner','tsunami']"
          - name: SAMMA_IO_JSON
            value: '{"extra":"value"}'
          - name: WRITE_TO_FILE
            value: "true"
          - name: PARSER
            value: tsunami
        volumeMounts:
          - mountPath: /out
            name: out-volume
      - name: logger
        image: sammascanner/logger:0.1
        env:
          - name: FILE
            value: tsunami-output.json
          - name: TARGET
            value: samma.io
          - name: SAMMA_IO_SCANNER
            value: tsunami
          - name: SAMMA_IO_ID
            value: "00000"
          - name: SAMMA_IO_TAGS
            value: "['scanner','tsunami']"
          - name: SAMMA_IO_JSON
            value: '{"extra":"value"}'
          - name: WRITE_TO_FILE
            value: "true"
          - name: PARSER
            value: tsunami
        volumeMounts:
          - mountPath: /out
            name: out-volume
      - name: filebeat
        image: docker.elastic.co/beats/filebeat:7.15.0
        env:
          - name: ELASTICSEARC
            value: http://elasticsearch:9200
        livenessProbe:
          exec:
            command:
              - /bin/sh
              - '-c'
              - /live.sh
          initialDelaySeconds: 10
          periodSeconds: 5
        volumeMounts:
        - name: filebeat
          mountPath: "/usr/share/filebeat/filebeat.yml"
          subPath: "filebeat.yml"
        - name: liveness
          mountPath: "/live.sh"
          subPath: "live.sh"
        - mountPath: /out
          name: out-volume
      volumes:
      - name: filebeat
        configMap:
          name: filebeat-ts
      - name: liveness
        configMap:
          name: live-ts
          defaultMode: 0777
      - name: out-volume
        emptyDir: {}
      restartPolicy: Never